# 基于 YOLOv11 的猫狗图像种类检测与分类

本项目基于 **YOLOv11-L** 框架，构建了一个面向猫狗品种识别任务的完整训练与测试系统，支持多模型融合、推理增强（TTA）、性能自动计算与可视化输出。  
通过自定义数据平衡与优化策略，实现了在多类别检测场景下的高精度与强鲁棒性。

## 一、功能概览

| 功能模块 | 说明 |
|-----------|------|
| **模型训练** | 自动断点续训、超参数优化、动态日志保存 |
| **数据增强** | Mosaic / MixUp / CopyPaste / Label Smoothing / Dropout |
| **样本平衡** | 自定义 `balance_dataset()`，自动过采样稀有类别 |
| **多模型融合** | Weighted Boxes Fusion (WBF) + IoU 抑制 |
| **测试增强 (TTA)** | 水平翻转推理增强，提升鲁棒性与 mAP |
| **性能评估** | 自动计算 Precision / Recall / F1 / mAP |
| **可视化输出** | 双子图（Per-Class 曲线 + 平均指标柱状图） |
| **断点恢复** | 自动检测 `last.pt` 实现 resume 训练 |

## 二、算法亮点

### 1. 多模型融合（Weighted Boxes Fusion）
- 对多个模型输出的边界框按置信度加权；
- 减少重复检测与冲突框；
- 在保留细节的同时提升整体稳定性。

### 2. 推理时增强（Test-Time Augmentation, TTA）
- 对输入图像进行**水平翻转**；
- 将原图与翻转预测结果反变换后融合；
- 对光照、角度、姿态变化具有更强鲁棒性；
- 可提升 mAP 约 **1–2%**。

### 3. 正则化策略
- **Label Smoothing (0.05)**：防止过拟合；
- **Dropout (0.05)**：提升泛化能力；
- **Weight Decay (0.0005)**：抑制过大权重。

### 4. 自动性能可视化
包含左右两幅图：
- 左图：各类别 Precision / Recall / mAP 曲线；
- 右图：平均指标柱状图；

### 5. 在 test.py 中同时调用两个模型文件用于推理判断

## 三、数据来源与标注

完整数据集为 merged_dataset.zip，包含 **训练集（train）**、**验证集（valid）** 与 **测试集（test）** 三部分。

### 1. 数据来源
本项目的数据集来自以下多个渠道，以确保多样性与泛化性：

- 助教提供的课程数据集  
- [**Kaggle**](https://www.kaggle.com/datasets) 开源猫狗图像集  
- [**iStockphoto**](https://www.istockphoto.com/) 商业授权图像  
- [**视觉中国**](https://www.visualchina.com/) 高分辨率样本  

### 2.数据标注
- **标注平台**：使用 [Roboflow](https://roboflow.com/) 进行高效标注与自动格式转换。  
- **标注格式**：采用 **YOLO 格式 (TXT)**，包含类别 ID 与归一化坐标。
  
### 3. 数据增强策略
- **随机裁剪（Crop）**：模拟视角变化，提高鲁棒性；  
- **亮度调整（Exposure）**：增强对光照条件变化的适应能力。  

### 4. 数据扩充
- 原始样本经增强后扩充至 **原始数量 × 3**，以减轻样本稀疏类别的不平衡问题。

### 5. 类别分布

| 类别名称 | 标签代号 |
|-----------|-----------|
| 布偶猫 | `cat_bo` |
| 孟买猫 | `cat_mm` |
| 奶牛猫 | `cat_nn` |
| 玳瑁虎纹猫 | `cat_hw` |
| 橘猫 | `cat_jm` |
| 土耳其梵猫 | `cat_teq` |
| 比格犬 | `dog_bige` |
| 贵宾犬 | `dog_guibing` |
| 哈巴狗 | `dog_habar` |
| 哈士奇 | `dog_hsq` |
| 阿拉斯加犬 | `dog_alsj` |
| 大白熊犬 | `dog_dbx` |
| 萨摩耶 | `dog_smy` |

## 四、硬件与软件环境

本项目在高性能计算平台 **AutoDL 算力云** 上完成模型训练与测试，具体硬件与软件配置如下表所示。

| 项目 | 配置 |
|------|------|
| **平台** | [**AutoDL 算力云平台**](https://www.autodl.com/home) |
| **GPU** | NVIDIA RTX 5090 (32GB) × 1 |
| **CPU** | Intel Xeon Platinum 8470Q (25 vCPU) |
| **内存** | 90 GB |
| **硬盘** | 系统盘 30 GB + 数据盘 50 GB SSD |
| **操作系统** | Ubuntu 22.04 |
| **CUDA** | 12.8 |
| **Python** | 3.12 |
| **PyTorch** | 2.8.0 |
| **Ultralytics** | 8.3.0（YOLOv11 框架） |

## 五、测试结果

经测试，本项目在 **401** 张测试图像上实现了以下效果：  
- **mAP@0.5** $\approx$ **0.933**
- **mAP@0.5:0.95** $\approx$ **0.852**
- **精确率** $\approx$ **0.952** 
- **召回率** $\approx$ **0.964**

**说明**

- 该软硬件配置在单 GPU 条件下即可稳定支持 YOLOv11-L 模型的训练与多模型融合推理，训练过程约占用 30GB 显存，可实现混合精度（AMP）加速与高效 I/O 读取。  
- 数据集在标注与扩充过程中保持了统一的分辨率与标注精度。各类别在增强后样本数量趋于均衡，为后续的训练与验证提供了良好的数据基础。
- 本次测试所采用的是 **merged_dataset.zip** 中的 **test** 部分，共计 401 张图像，涵盖所有 13 个类别。
- 上传的 **final test.zip** 文件包含了助教提供的最终测试集，是课程的最后测试部分，现场测试效果不错。
- 本项目在**哈士奇**与**阿拉斯加犬**等形态相似类别的区分上仍存在挑战，希望有好的**建议**。
- 部分代码在 [**ChatGPT**](https://chatgpt.com/) 的帮助下完成。

**致谢**

感谢 [**AutoDL 算力云平台**](https://www.autodl.com/home) 为本项目提供高性能计算资源，使得 YOLOv11 模型的训练与多模型融合推理得以顺利完成。  
感谢 [**Ultralytics 团队**](https://www.ultralytics.com/) 开源的 YOLO 框架与持续更新，为本项目提供了坚实的技术基础。  
感谢开源社区中众多开发者和研究者，他们在 **PyTorch**、**OpenCV**、**Matplotlib** 等框架中的贡献，为本项目的实现提供了关键支持。  
感谢所有在数据采集、标注与实验验证阶段参与协作的同学们，正是他们的努力，使得这项研究工作得以顺利完成。

本项目基于 [**MIT License**](./LICENSE) 开源发布。  
如在学术或商业场景中使用，请保留作者署名及项目引用链接。
